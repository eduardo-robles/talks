<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>Quick, Easy, Malware Investigations and Threat Hunting</title>
<meta name="author" content="Eduardo Robles"/>
<meta name="description" content=""/>
<meta name="keywords" content=""/>
<style type="text/css">
.underline { text-decoration: underline; }
</style>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reveal.js/dist/reveal.css"/>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reveal.js/dist/theme/white.css" id="theme"/>


<!-- If the query includes 'print-pdf', include the PDF print sheet -->
<script>
    if( window.location.search.match( /print-pdf/gi ) ) {
        var link = document.createElement( 'link' );
        link.rel = 'stylesheet';
        link.type = 'text/css';
        link.href = 'https://cdn.jsdelivr.net/npm/reveal.js/css/print/pdf.css';
        document.getElementsByTagName( 'head' )[0].appendChild( link );
    }
</script>
</head>
<body>
<div class="reveal">
<div class="slides">
<section id="sec-title-slide"><h1 class="title">Quick, Easy, Malware Investigations and Threat Hunting</h1><p class="subtitle"></p>
<h2 class="date">20240216</h2><p class="date">Created: 2024-11-17 Sun 22:18</p>
</section>

<section>
<section id="slide-org2e22ae5">
<h2 id="org2e22ae5">Bsides Austin 2024</h2>
<div class="org-center">
<p>
Quick, Easy, Malware Investigations and Threat Hunting
</p>
</div>

</section>
</section>
<section>
<section id="slide-orgf8b2dc2">
<h2 id="orgf8b2dc2">About Me</h2>
<ul>
<li>Hi! I'm Eduardo Robles I work for County of Hidalgo IT dept as a Cybersecurity Analyst IV</li>
<li>Founder of South Texas Linux Users Group.</li>
<li>You can check out my skills on my blog or LinkedIn.</li>

</ul>
</section>
</section>
<section>
<section id="slide-org1dcd307">
<h2 id="org1dcd307">Agenda</h2>
<ol>
<li>Learn the basics of Malware Analysis</li>
<li>Learn some Threat Hunting skills</li>
<li>Small look at Reverse Engineering and Digital Forensics</li>

</ol>
</section>
</section>
<section>
<section id="slide-org5e45abf">
<h2 id="org5e45abf">Malware Investigations</h2>
<div class="outline-text-2" id="text-org5e45abf">
</div>
</section>
<section id="slide-orgf4567bd">
<h3 id="orgf4567bd">Why do internal malware analysis?</h3>
<ul>
<li>Existing tools Virustotal, JoeSandbox, etc.</li>
<li>Protect sensitive information from 3rd parties.</li>
<li>Freedom from reliance on one tool or platform.</li>

</ul>
</section>
<section id="slide-org441b841">
<h3 id="org441b841">Malware is scary and dangerous, put in a box (container).</h3>
<p>
Malware is scary. Malware is dangerous. So it's best to analyze in a contained environment.
</p>
<ul>
<li>Virtual Machines</li>
<li>Containers (Docker, Podman, etc)</li>

</ul>
</section>
<section id="slide-org53dc217">
<h3 id="org53dc217">Working with Malware Samples</h3>
<p>
Safely moving malware around to later analyze can be daunting. Here are some pointers.
</p>
</section>
<section id="slide-orgee49fd0">
<h4 id="orgee49fd0">Defang</h4>
<p>
Take a normal hyperlink or file extention and defang it so it's not active.
</p>
<ul>
<li>Normal</li>

</ul>
<pre class="example" id="orgf886aea">
https://eduardorobles.com or superbadmalware.exe
</pre>
<ul>
<li>Defanged</li>

</ul>
<pre class="example" id="org02f8e5b">
hxxps://eduardorobles[.]com or superbadmalware.malz
</pre>
</section>
<section id="slide-org55628a0">
<h4 id="org55628a0">Encrypted Archive with a Password (7zip)</h4>
<p>
Use 7zip to password encrypt an archive. This add an extra layer of protection by not allowing someone to accidently open the archive.
</p>
</section>
<section id="slide-org3e2725d">
<h4 id="org3e2725d">Disable network access</h4>
<ul>
<li>You can disable network access to your malware analysis station.</li>
<li>This stops malware from communicating to a C2 infrastruture.</li>
<li>Or you can also simulate network traffic if you want to analyze what the malware might be trying to communicate with.</li>

</ul>
</section>
<section id="slide-org22ce87e">
<h3 id="org22ce87e">REMnux</h3>
<p>
If you want easy button for malware analysis use <b>REMnux</b> as a VM or a container!
<a href="https://remnux.org">https://remnux.org</a>
</p>
<blockquote >
<p>
REMnux: A Linux Toolkit for Malware Analysis
</p>
</blockquote>

</section>
<section id="slide-org75b9f87">
<h3 id="org75b9f87">Setup REMnux in a Container</h3>
<p>
REMnux offers several <a href="https://docs.remnux.org/install-distro/remnux-as-a-container">container</a> images as well the full REMnux distro in a container.
</p>
<ul>
<li>The container technology they chose is Docker but I have chosen to use Podman.</li>
<li>Podman seems to have better support in Windows as well as Linux.</li>
<li>So I can have Podman running in both the Malware Analysis station and on my Windows machine. This gives me the flexibility to test on either machine or platform.</li>

</ul>
</section>
<section id="slide-org68f2f74">
<h4 id="org68f2f74">Install REMnux container</h4>
<div class="org-src-container">

<pre  class="src src-sh"   ><code trim>podman pull docker.io/remnux/remnux-distro:focal
</code></pre>
</div>
</section>
<section id="slide-org5411264">
<h4 id="org5411264">Run REMnux as a Transient container</h4>
<div class="org-src-container">

<pre  class="src src-sh"   ><code trim>podman run <span style="color: #af9fff;">\</span>
       --rm <span style="color: #af9fff;">\</span>
       -d <span style="color: #af9fff;">\</span>
       --name malContainer <span style="color: #af9fff;">\</span>
       -v /var/home/core/SAMPLES:/home/remnux/files <span style="color: #af9fff;">\</span>
       --privileged <span style="color: #af9fff;">\</span>
       --network none <span style="color: #af9fff;">\</span>
       remnux/remnux-distro:focal
</code></pre>
</div>
<p>
What the previous command did
</p>
<ul>
<li><code>--rm</code> Remove the container after it exists (not the image)</li>
<li><code>-it</code> Connect the container to the terminal</li>
<li><code>-u remnux</code> Logged in user (optional)</li>
<li><code>--privileged</code> Runs container with Root privileges (optional)</li>
<li><code>--network none</code> Disables any network from the container (optional)</li>
<li><code>remnux/remnux-distro:focal</code> Container image to use, in this case use the local image</li>
<li><code>bash</code> Login shell</li>

</ul>
</section>
</section>
<section>
<section id="slide-org359457b">
<h2 id="org359457b">Demo</h2>
</section>
</section>
<section>
<section id="slide-orge65a7ef">
<h2 id="orge65a7ef">Digital Forensics</h2>
<div class="outline-text-2" id="text-orge65a7ef">
</div>
</section>
<section id="slide-org68e99c4">
<h3 id="org68e99c4">Phishing Email Analysis</h3>
<div class="outline-text-3" id="text-org68e99c4">
</div>
</section>
<section id="slide-orgd75a12c">
<h4 id="orgd75a12c">ClamAV</h4>
<p>
ClamAV is great to scan for malware but also can scan <code>eml</code> files including email attachments. Use the <code>--debug</code> flag for more info on the scan.
</p>
<div class="org-src-container">

<pre  class="src src-sh"   ><code trim>clamscan sample.eml
</code></pre>
</div>
</section>
<section id="slide-org51aaa37">
<h4 id="org51aaa37">Continued</h4>
<p>
You can also use ClamAV to scan any suspicious file.
</p>
<div class="org-src-container">

<pre  class="src src-sh"   ><code trim>clamscan sample.zip
</code></pre>
</div>

</section>
<section id="slide-orgeefc449">
<h3 id="orgeefc449">Investigating a malicious link</h3>
<p>
To investigate a link REMnux offers so many awesome tools. I will cover THUG and Automater.
</p>
</section>
<section id="slide-org5c34d40">
<h4 id="org5c34d40">THUG</h4>
<p>
THUG is a “honeyclient”. A honeyclient is a tool that mimicks the behavior of a web browser. Useful for analyzing what a link does when a user clicks on it.
</p>

<div class="org-src-container">

<pre  class="src src-sh"   ><code trim>thug -u win7chrome49 <span style="color: #af9fff;">"https://eduardorobles.com"</span>
</code></pre>
</div>
</section>
<section id="slide-orgd8e5ca5">
<h4 id="orgd8e5ca5">Continued&#x2026;</h4>
<p>
Once it begins to “load” the suspicious site it executes any code that may be on the site. Once it is done running/loading the page it dumps a report. The report contains a summary of what occured plus you get any malicious artifacts that the page may have downloaded.
</p>

<p>
In one exercise a suspicous page downloaded an executable and I was able to analyze the executable from the container and it was indeed a malicous executable. Yikes!
</p>
</section>
<section id="slide-orgbc458a3">
<h4 id="orgbc458a3">Automater</h4>
<blockquote >
<p>
Automater is a URL/Domain, IP Address, and Md5 Hash OSINT tool aimed at making the analysis process easier for intrusion Analysts. Given a target (URL, IP, or HASH) or a file full of targets Automater will return relevant results from sources like the following: IPvoid.com, Robtex.com, Fortiguard.com, unshorten.me, Urlvoid.com, Labs.alienvault.com, ThreatExpert, VxVault, and VirusTotal.
</p>
</blockquote>
</section>
<section id="slide-org8f6989a">
<h4 id="org8f6989a">Continued&#x2026;</h4>
<p>
Automater is a python tool found in <code>/usr/local/automater</code>
</p>
<div class="org-src-container">

<pre  class="src src-sh"   ><code trim>./Automater.py https://eduardorobles.com
</code></pre>
</div>


</section>
<section id="slide-orga0e554a">
<h3 id="orga0e554a">Investigating a suspicious PDF</h3>
<p>
Malicous content will be embedded. It's best to extract the content in order to inspect it.
</p>

</section>
<section id="slide-orgda037ed">
<h4 id="orgda037ed">Strings</h4>
<p>
You can use the command <code>strings</code> to view all the different system call a file contains.
</p>
<pre  class="example" >
strings sus_invoice.pdf | grep http
</pre>

<p>
You can also pipe grep to single out things like <code>http</code> links or hashes.
</p>
</section>
<section id="slide-org9e0bd5b">
<h4 id="org9e0bd5b">Magika</h4>
<pre  class="example" >
pip install magika
</pre>
</section>
</section>
<section>
<section id="slide-orgdbcec38">
<h2 id="orgdbcec38">Threat Hunting</h2>
<div class="outline-text-2" id="text-orgdbcec38">
</div>
</section>
<section id="slide-org26d02dd">
<h3 id="org26d02dd">Velociraptor</h3>
<p>
Worth every penny!
</p>
</section>
<section id="slide-org4495f35">
<h3 id="org4495f35">Setup REMnux container for Analysis</h3>
<p>
This container will run in priviledged mode and will have no network attached to it
</p>
<div class="org-src-container">

<pre  class="src src-sh"   ><code trim>podman run --rm -it <span style="color: #af9fff;">\</span>
       --name malContainer <span style="color: #af9fff;">\</span>
       --privileged <span style="color: #af9fff;">\</span>
       --network none <span style="color: #af9fff;">\</span>
       remnux/remnux-distro:focal bash
</code></pre>
</div>
</section>
<section id="slide-org0db36a0">
<h3 id="org0db36a0">Yara</h3>
<p>
<a href="https://github.com/airbnb/binaryalert/blob/master/rules/public/eicar.yara">https://github.com/airbnb/binaryalert/blob/master/rules/public/eicar.yara</a>
</p>
<div class="org-src-container">

<pre  class="src src-yara"   ><code trim><span style="color: #00c089; font-weight: bold;">rule</span> <span style="color: #7fc500;">eicar_av_test</span> {
    <span style="color: #b7a07f; font-style: italic;">/*</span>
<span style="color: #b7a07f; font-style: italic;">       Per standard, match only if entire file is EICAR string plus optional trailing whitespace.</span>
<span style="color: #b7a07f; font-style: italic;">       The raw EICAR string to be matched is:</span>
<span style="color: #b7a07f; font-style: italic;">       X5O!P%@AP[4\PZX54(P^)7CC)7}$EICAR-STANDARD-ANTIVIRUS-TEST-FILE!$H+H*</span>
<span style="color: #b7a07f; font-style: italic;">    */</span>

    <span style="color: #cfc04f;">meta</span>:
        <span style="color: #37aff6;">description</span> = <span style="color: #af9fff;">"This is a standard AV test, intended to verify that BinaryAlert is working correctly."</span>
        <span style="color: #37aff6;">author</span> = <span style="color: #af9fff;">"Austin Byers | Airbnb CSIRT"</span>
        <span style="color: #37aff6;">reference</span> = <span style="color: #af9fff;">"http://www.eicar.org/86-0-Intended-use.html"</span>

    <span style="color: #cfc04f;">strings</span>:
        <span style="color: #78afff;">$eicar_regex</span> = /^X5O!P%@AP\[4\\PZX54\(P\^\)7CC\)7\}\<span style="color: #78afff;">$EICAR</span>-STANDARD-ANTIVIRUS-TEST-FILE!\<span style="color: #78afff;">$H</span>\+H\*\s*$/

    <span style="color: #cfc04f;">condition</span>:
        <span style="color: #00c089; font-weight: bold;">all</span> <span style="color: #00c089; font-weight: bold;">of</span> <span style="color: #00c089; font-weight: bold;">them</span>
}

<span style="color: #00c089; font-weight: bold;">rule</span> <span style="color: #7fc500;">eicar_substring_test</span> {
    <span style="color: #b7a07f; font-style: italic;">/*</span>
<span style="color: #b7a07f; font-style: italic;">       More generic - match just the embedded EICAR string (e.g. in packed executables, PDFs, etc)</span>
<span style="color: #b7a07f; font-style: italic;">    */</span>

    <span style="color: #cfc04f;">meta</span>:
        <span style="color: #37aff6;">description</span> = <span style="color: #af9fff;">"Standard AV test, checking for an EICAR substring"</span>
        <span style="color: #37aff6;">author</span> = <span style="color: #af9fff;">"Austin Byers | Airbnb CSIRT"</span>

    <span style="color: #cfc04f;">strings</span>:
        <span style="color: #78afff;">$eicar_substring</span> = <span style="color: #af9fff;">"$EICAR-STANDARD-ANTIVIRUS-TEST-FILE!"</span>

    <span style="color: #cfc04f;">condition</span>:
        <span style="color: #00c089; font-weight: bold;">all</span> <span style="color: #00c089; font-weight: bold;">of</span> <span style="color: #00c089; font-weight: bold;">them</span>
}
</code></pre>
</div>
</section>
<section id="slide-orge1b9fb2">
<h3 id="orge1b9fb2">Tools</h3>
<div class="outline-text-3" id="text-orge1b9fb2">
</div>
</section>
<section id="slide-org29a9578">
<h4 id="org29a9578">Cyberchef</h4>
<p>
A great tool!
</p>
<blockquote >
<p>
GCHQ CyberChef in a container. CyberChef is the Cyber Swiss Army Knife web app for encryption, encoding, compression and data analysis.
</p>
</blockquote>
<p>
Let's run it in a container!
</p>
<div class="org-src-container">

<pre  class="src src-sh"   ><code trim>podman run <span style="color: #af9fff;">\</span>
       -d <span style="color: #af9fff;">\</span>
       --name cyberchef <span style="color: #af9fff;">\</span>
       -p 8000:8000 <span style="color: #af9fff;">\</span>
       mpepping/cyberchef
</code></pre>
</div>
</section>
</section>
<section>
<section id="slide-org358d480">
<h2 id="org358d480">Conclusion</h2>

</section>
</section>
<section>
<section id="slide-orgdab26e1">
<h2 id="orgdab26e1">Questions</h2>

</section>
</section>
<section>
<section id="slide-org285c49f">
<h2 id="org285c49f">Thanks</h2>
</section>
</section>
</div>
</div>
<script src="https://cdn.jsdelivr.net/npm/reveal.js/dist/reveal.js"></script>

<script>
// Full list of configuration options available here:
// https://github.com/hakimel/reveal.js#configuration
Reveal.initialize({

// Optional libraries used to extend on reveal.js
dependencies: [
 { src: 'https://cdn.jsdelivr.net/npm/reveal.js/plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
 { src: 'https://cdn.jsdelivr.net/npm/reveal.js/plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
 { src: 'https://cdn.jsdelivr.net/npm/reveal.js/plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
 { src: 'https://cdn.jsdelivr.net/npm/reveal.js/plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }]

});

</script>
</body>
</html>
